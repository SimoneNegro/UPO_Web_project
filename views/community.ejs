<%- include('includes/head.ejs') %>

<body>
  <!-- HEADER -->
  <%- include('includes/header.ejs') %>
  <!-- CONTENT -->
  <main>
    <div class="container">
      <!-- TITLE -->
      <h2>Community</h2>
      <p>Here you can find all the tickets opened by users along with the resolution of the issue!</p>
      <!-- TICKET AND DESCRIPTION -->
      <section>
        <% descriptions.forEach(description => { %>
        <form>
          <input id="gestisci_id" name="gestisci_id" type="hidden" value="<%= description.id %>">
          <div class="border-bottom pt-3 row justify-content-left">
            <div class="col-sm-10">
              <h5>
                <%= description.descrizione %>
              </h5>
              <p>
                <%= description.nome_topic %>
              </p>
            </div>
            <div class="col-sm-2">
              <% if(!user) { %>
              <h5>
                <%= description.like %> <i class="fa-regular fa-heart"></i>
              </h5>
              <% } else { %>
              <% let like = false; %>
              <% likedContents.forEach(liked => { %>
              <% if(liked.id_utente === user.id && liked.id_gestisce === description.id) { %>
              <% like = true; %>
              <h5>
                <%= description.like %> <button class="like-button"><i class="fa-solid fa-heart like"></i></button>
              </h5>
              <% } %>
              <% }); %>
              <% if(!like) { %>
              <h5>
                <%= description.like %> <button class="like-button"><i class="fa-regular fa-heart switch-color"></i></button>
              </h5>
              <% }%>
              <% } %>
              <p>
                <%= new Date(description.chiusura_ticket * 1000).toLocaleDateString(); %>
              </p>
            </div>
          </div>
        </form>
        <% }); %>
      </section>
      <!-- PAGE SELECTOR -->
      <% if (totalPages > 1) { %>
      <div class="d-flex justify-content-center pt-4 pb-4">
        <% if (currentPage > 1) { %>
        <a href="/community/?page=<%= currentPage - 1 %>" class="pe-2">Previous</a>
        <% } else { %>
        <span class="pe-2">Previous</span>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
        <% if (i === currentPage) { %>
        <strong class="pe-2"><%= i %></strong>
        <% } else { %>
        <a class="pe-2" href="/community/?page=<%= i %>"><%= i %></a>
        <% } %>
        <% } %>

        <% if (currentPage < totalPages) { %>
        <a href="/community/?page=<%= currentPage + 1 %>">Next</a>
        <% } else { %>
        <span>Next</span>
        <% } %>
      </div>
      <% } %>
    </div>
  </main>
  <!-- FOOTER -->
  <%- include('includes/footer.ejs') %>
  <!-- SCRIPTS-->
  <%- include('includes/scripts.ejs') %>
</body>

</html>